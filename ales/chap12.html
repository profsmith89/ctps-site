

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Chapter 12 &#8212; Computational Thinking and Problem Solving</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'chap12';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chapter 13" href="chap13.html" />
    <link rel="prev" title="Chapter 11" href="chap11.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="ctps-ales.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/mike_flat.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/mike_flat.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="ctps-ales.html">
                    <no title>
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="chap01.html">Chapter 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap02.html">Chapter 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap03.html">Chapter 3</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap04.html">Chapter 4</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap05.html">Chapter 5</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap06.html">Chapter 6</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap07.html">Chapter 7</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap08.html">Chapter 8</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap09.html">Chapter 9</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap10.html">Chapter 10</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap11.html">Chapter 11</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Chapter 12</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap13.html">Chapter 13</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap14.html">Chapter 14</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap15.html">Chapter 15</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap16.html">Chapter 16</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap17.html">Chapter 17</a></li>
<li class="toctree-l1"><a class="reference internal" href="chap18.html">Chapter 18</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/chap12.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Chapter 12</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ale-12-1-a-shell-game">ALE 12.1: A shell game</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ale-12-2-taco-cat">ALE 12.2: Taco cat</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ale-12-3-fib-frequently-and-forever">ALE 12.3: Fib frequently and forever</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="chapter-12">
<h1>Chapter 12<a class="headerlink" href="#chapter-12" title="Permalink to this heading">#</a></h1>
<section id="ale-12-1-a-shell-game">
<h2>ALE 12.1: A shell game<a class="headerlink" href="#ale-12-1-a-shell-game" title="Permalink to this heading">#</a></h2>
<p>In the chapter, we learned that the sort most of us use to order the playing cards when dealt a hand is called <em>insertion sort</em>. Despite the fact that it isn’t that efficient—it has a worst-case performance of <span class="math notranslate nohighlight">\(O(n^2)\)</span>—it was easy to understand and code.</p>
<p>In this exercise, we’ll look at a related sort called <em>Shellsort</em>, which is named after Donald Shell who published the first description of the method in 1959. I grabbed the pseudocode for this sort from <a class="reference external" href="https://en.wikipedia.org/wiki/Shellsort">Wikipedia</a> and implemented a version of it in Python. How it works is much more cryptic.</p>
<p><strong>Step 1.</strong> Re-familiarize yourself with insertion sort by reading through the following code. This version counts the number of swaps that the algorithm takes to sort the input list. If you want to see these swaps as they take place, uncomment the print-statements on lines 10 and 15. <strong>Make sure to replace the comment characters before you proceed to the next step.</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap12/ale01/insertion.py</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">insertion_sort</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="sd">&#39;&#39;&#39;Sorts the unsorted sequence s in place and</span>
<span class="linenos"> 5</span><span class="sd">       returns the number of swaps performed.</span>
<span class="linenos"> 6</span><span class="sd">    &#39;&#39;&#39;</span>
<span class="linenos"> 7</span>    <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)):</span>
<span class="linenos">10</span>        <span class="c1">#print(f&#39;Considering item at index {i}&#39;)</span>
<span class="linenos">11</span>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
<span class="linenos">12</span>            <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
<span class="linenos">13</span>                <span class="c1"># Swap the two items</span>
<span class="linenos">14</span>                <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
<span class="linenos">15</span>                <span class="c1">#print(f&#39;Swapped {j-1},{j}: {s}&#39;)</span>
<span class="linenos">16</span>                <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">17</span>            <span class="k">else</span><span class="p">:</span>
<span class="linenos">18</span>                <span class="c1"># When swaps are done, the ith element is where it belongs</span>
<span class="linenos">19</span>                <span class="k">break</span>
<span class="linenos">20</span>                
<span class="linenos">21</span>    <span class="k">return</span> <span class="n">swaps</span>
</pre></div>
</div>
<p>You can test <code class="docutils literal notranslate"><span class="pre">insertion_sort</span></code> using this code block:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">25</span><span class="c1">### chap12/ale01/insertion.py</span>
<span class="linenos">26</span>
<span class="linenos">27</span><span class="c1"># A simple test routine</span>
<span class="linenos">28</span><span class="n">s_test</span> <span class="o">=</span> <span class="p">[</span><span class="mi">62</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>
<span class="linenos">29</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unsorted list: </span><span class="si">{</span><span class="n">s_test</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">30</span>    
<span class="linenos">31</span><span class="n">swaps</span> <span class="o">=</span> <span class="n">insertion_sort</span><span class="p">(</span><span class="n">s_test</span><span class="p">)</span>
<span class="linenos">32</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sorted list: </span><span class="si">{</span><span class="n">s_test</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">33</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total swaps (INSERTION sort) = </span><span class="si">{</span><span class="n">swaps</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Step 2.</strong> Now let’s look at the code for Shellsort and try to understand its behavior (i.e., don’t yet run it). To be clear, I don’t expect you to go through every line of code. Instead, we’ll practice our skills at understanding the computational complexity of an algorithm.</p>
<p>Let’s start with a simple question. In the function <code class="docutils literal notranslate"><span class="pre">shell_sort</span></code>, <strong>how many loops do you see?</strong> You can ignore the function <code class="docutils literal notranslate"><span class="pre">gen_gaps</span></code>, i.e., assume the call to that function takes a fixed amount of time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap12/ale01/shell.py</span>
<span class="linenos"> 2</span><span class="sd">&#39;&#39;&#39;</span>
<span class="linenos"> 3</span><span class="sd">Shellsort, translated to Python using pseudocode from: </span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="sd">https://en.wikipedia.org/wiki/Shellsort</span>
<span class="linenos"> 6</span><span class="sd">&#39;&#39;&#39;</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k">def</span> <span class="nf">gen_gaps</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="linenos"> 9</span><span class="w">    </span><span class="sd">&#39;&#39;&#39;Compute and return a shellsort gap sequence&#39;&#39;&#39;</span>
<span class="linenos">10</span>    <span class="n">gaps</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">11</span>    <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span>
<span class="linenos">12</span>    <span class="n">g</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>
<span class="linenos">13</span>    <span class="k">while</span> <span class="n">g</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">14</span>        <span class="n">gaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
<span class="linenos">15</span>        <span class="n">k</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">16</span>        <span class="n">g</span> <span class="o">=</span> <span class="n">n</span> <span class="o">//</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">k</span><span class="p">)</span>
<span class="linenos">17</span>    <span class="k">return</span> <span class="n">gaps</span>
<span class="linenos">18</span>    
<span class="linenos">19</span>
<span class="linenos">20</span><span class="k">def</span> <span class="nf">shell_sort</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="linenos">21</span><span class="w">    </span><span class="sd">&#39;&#39;&#39;Sorts the unsorted sequence s in place and</span>
<span class="linenos">22</span><span class="sd">       returns the number of swaps performed.</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="sd">       Comments below this line are unchanged from</span>
<span class="linenos">25</span><span class="sd">       the wikipedia entry.</span>
<span class="linenos">26</span><span class="sd">    &#39;&#39;&#39;</span>
<span class="linenos">27</span>    <span class="n">swaps</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">28</span>
<span class="linenos">29</span>    <span class="n">gaps</span> <span class="o">=</span> <span class="n">gen_gaps</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
<span class="linenos">30</span>    <span class="c1">#print(f&#39;gap sequence: {gaps}\n&#39;)</span>
<span class="linenos">31</span>    
<span class="linenos">32</span>    <span class="c1"># Start with the largest gap and work down to a gap of 1</span>
<span class="linenos">33</span>    <span class="c1"># similar to insertion sort but instead of 1, gap is being used in each step</span>
<span class="linenos">34</span>    <span class="k">for</span> <span class="n">gap</span> <span class="ow">in</span> <span class="n">gaps</span><span class="p">:</span>
<span class="linenos">35</span>        <span class="c1"># Do a gapped insertion sort for every elements in gaps</span>
<span class="linenos">36</span>        <span class="c1"># Each loop leaves a[0..gap-1] in gapped order</span>
<span class="linenos">37</span>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">gap</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
<span class="linenos">38</span>    
<span class="linenos">39</span>            <span class="c1"># save s[i] in temp and make a hole at position i</span>
<span class="linenos">40</span>            <span class="n">temp</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="linenos">41</span>    
<span class="linenos">42</span>            <span class="c1"># shift earlier gap-sorted elements up until the correct location</span>
<span class="linenos">43</span>            <span class="c1"># for s[i] is found</span>
<span class="linenos">44</span>            <span class="n">j</span> <span class="o">=</span> <span class="n">i</span>
<span class="linenos">45</span>            <span class="k">while</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">gap</span> <span class="ow">and</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="n">gap</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">temp</span><span class="p">:</span>
<span class="linenos">46</span>                <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="n">gap</span><span class="p">]</span>
<span class="linenos">47</span>                <span class="n">j</span> <span class="o">-=</span> <span class="n">gap</span>
<span class="linenos">48</span>                <span class="n">swaps</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">49</span>    
<span class="linenos">50</span>            <span class="c1"># put temp (the original a[i]) in its correct location</span>
<span class="linenos">51</span>            <span class="n">s</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span>
<span class="linenos">52</span>
<span class="linenos">53</span>    <span class="k">return</span> <span class="n">swaps</span>
</pre></div>
</div>
<p>You should see three: a for-loop on line 34; another on line 37; and a while-loop on line 45.</p>
<p>We know that nested loops mean multiplication: we multiply together the expected iteration count of each loop. But the innermost of the three loops in <code class="docutils literal notranslate"><span class="pre">shell_sort</span></code> is a while-loop with a complex looping condition, it’s not easy to tell how many iterations it will take.</p>
<p>If you’re tempted to figure out the computational complexity of <code class="docutils literal notranslate"><span class="pre">shell_sort</span></code>, <strong>don’t</strong>. It is an open question in computer science. Instead, we’ll just check our intuition.</p>
<p><em>Do you expect a sort with <strong>three</strong> nested loops to take more or less time than one with <strong>two</strong> nested loops?</em></p>
<p>When you’ve decided on an answer to this question, move on.</p>
<p><strong>Step 3.</strong> As a proxy for execution time, we’ll count the number of swaps each sorting algorithm performs. Notice that <code class="docutils literal notranslate"><span class="pre">shell_sort</span></code> counts the number of swaps that it does on line 48, and like our implementation of <code class="docutils literal notranslate"><span class="pre">insertion_sort</span></code>, it returns this count (in addition to sorting the input array in place).</p>
<p>Suspense is over! Have <code class="docutils literal notranslate"><span class="pre">shell_sort</span></code> order the same test list we used for <code class="docutils literal notranslate"><span class="pre">insertion_sort</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">57</span><span class="c1">### chap12/ale01/shell.py</span>
<span class="linenos">58</span>
<span class="linenos">59</span><span class="c1"># A simple test routine</span>
<span class="linenos">60</span><span class="n">s_test</span> <span class="o">=</span> <span class="p">[</span><span class="mi">62</span><span class="p">,</span> <span class="mi">83</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">69</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>
<span class="linenos">61</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unsorted list: </span><span class="si">{</span><span class="n">s_test</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">62</span>    
<span class="linenos">63</span><span class="n">swaps</span> <span class="o">=</span> <span class="n">shell_sort</span><span class="p">(</span><span class="n">s_test</span><span class="p">)</span>
<span class="linenos">64</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;sorted list: </span><span class="si">{</span><span class="n">s_test</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">65</span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;total swaps (SHELL sort) = </span><span class="si">{</span><span class="n">swaps</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Are you surprised?</p>
<p><strong>Step 4.</strong> Maybe you think I pulled a fast one on you. Let’s compare these two sorting algorithms by generating a number of large arrays of random numbers.</p>
<p>In the following code block, the function <code class="docutils literal notranslate"><span class="pre">rnd_list</span></code> generates a list of length <code class="docutils literal notranslate"><span class="pre">n</span></code> of random numbers between <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">max_elem</span></code> inclusive. The function <code class="docutils literal notranslate"><span class="pre">aprint</span></code> avoids printing all the elements in a very long list, where “very long” is defined as more than 10 elements.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 7</span><span class="c1">### chap12/ale01/cmp.py</span>
<span class="linenos"> 8</span><span class="kn">import</span> <span class="nn">random</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="k">def</span> <span class="nf">rnd_list</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">max_elem</span><span class="p">):</span>
<span class="linenos">11</span><span class="w">    </span><span class="sd">&#39;&#39;&#39;Generate a random, unsorted list &#39;a&#39; of n numbers </span>
<span class="linenos">12</span><span class="sd">       between 0 and max_elem</span>
<span class="linenos">13</span><span class="sd">    &#39;&#39;&#39;</span>
<span class="linenos">14</span>    <span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
<span class="linenos">15</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="linenos">16</span>        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">max_elem</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)))</span>
<span class="linenos">17</span>    <span class="k">return</span> <span class="n">a</span>
<span class="linenos">18</span>
<span class="linenos">19</span><span class="k">def</span> <span class="nf">aprint</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
<span class="linenos">20</span><span class="w">    </span><span class="sd">&#39;&#39;&#39;Avoids printing huge arrays&#39;&#39;&#39;</span>
<span class="linenos">21</span>    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">22</span>
<span class="linenos">23</span>    <span class="nb">print</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="linenos">24</span>    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
<span class="linenos">25</span>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[</span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s1">, ... </span><span class="se">\</span>
<span class="linenos">26</span><span class="s1">              </span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
<span class="linenos">27</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>We’ll now use these helper functions to run three competitions between <code class="docutils literal notranslate"><span class="pre">insertion_sort</span></code> and <code class="docutils literal notranslate"><span class="pre">shell_sort</span></code>. Run the next code block several times.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 7</span><span class="c1">### chap12/ale01/cmp.py</span>
<span class="linenos"> 8</span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">):</span>
<span class="linenos"> 9</span>    <span class="n">a</span> <span class="o">=</span> <span class="n">rnd_list</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">999</span><span class="p">)</span>
<span class="linenos">10</span>    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">***</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> elements in array***&#39;</span><span class="p">)</span>
<span class="linenos">13</span>    <span class="n">aprint</span><span class="p">(</span><span class="s1">&#39;  unsorted list: &#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="linenos">14</span>    <span class="nb">print</span><span class="p">()</span>
<span class="linenos">15</span>
<span class="linenos">16</span>    <span class="n">swaps</span> <span class="o">=</span> <span class="n">insertion_sort</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="linenos">17</span>    <span class="n">aprint</span><span class="p">(</span><span class="s1">&#39;  sorted list: &#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="linenos">18</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  total swaps (INSERTION sort) = </span><span class="si">{</span><span class="n">swaps</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">19</span>
<span class="linenos">20</span>    <span class="nb">print</span><span class="p">()</span>
<span class="linenos">21</span>
<span class="linenos">22</span>    <span class="n">swaps</span> <span class="o">=</span> <span class="n">shell_sort</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="linenos">23</span>    <span class="n">aprint</span><span class="p">(</span><span class="s1">&#39;  sorted list: &#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="linenos">24</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  total swaps (SHELL sort) = </span><span class="si">{</span><span class="n">swaps</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Wild, huh?</p>
<p><strong>Step 5.</strong> Here’s a brief explanation of why <code class="docutils literal notranslate"><span class="pre">shell_sort</span></code> wins, as described at the start of the Wikipedia article referenced above: <em>“The method starts by sorting pairs of elements far apart from each other, then progressively reducing the gap between elements to be compared. By starting with far apart elements, it can move some out-of-place elements into position faster than a simple nearest neighbor exchange.”</em></p>
<p>That’s a wonderful example of “here’s an idea for how we might do things more efficiently.” Of course, an idea needs to be fleshed out. Donald Shell did that. And with some code, he showed that it worked more efficiently <em>in practice</em>. He also left us with a puzzle, and you can read the Wikipedia page for more on that.</p>
</section>
<section id="ale-12-2-taco-cat">
<h2>ALE 12.2: Taco cat<a class="headerlink" href="#ale-12-2-taco-cat" title="Permalink to this heading">#</a></h2>
<p>In this active learning exercise, our problem to solve is identifying palindromes! And you’re going to do it using a divide-and-conquer approach and then code that approach using recursion.</p>
<p>A palindrome is a word or phrase that is unchanged whether you read it from left to right or right to left. The word ‘kayak’ is an example of a palindrome. Ignoring spaces, the title of this ALE is another palindrome, which might be a weirdly named pet.</p>
<p>Your task is to write a function called <code class="docutils literal notranslate"><span class="pre">is_palindrome</span></code> that takes a single formal parameter <code class="docutils literal notranslate"><span class="pre">s</span></code>, which it expects to be a string, and returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the input string is a palindrome and <code class="docutils literal notranslate"><span class="pre">False</span></code> otherwise.</p>
<p><strong>Step 1.</strong> Recursion expects that the parameter to the recursive call inside the recursive function is somehow a smaller version of the problem. What might we do to a palindrome to create a smaller version of the problem?</p>
<p>Well, consider the example word I gave above: kayak. This word is a palindrome if:</p>
<ol class="arabic simple">
<li><p>the first and last letters satisfy what we expect in a palindrome; and</p></li>
<li><p>the remaining middle three letters are also a palindrome.</p></li>
</ol>
<p>To answer the second statement, we’d call is_palindrome on ‘aya’. If <code class="docutils literal notranslate"><span class="pre">s</span></code> is the name given to the string <code class="docutils literal notranslate"><span class="pre">'kayak'</span></code>, write a check for the first statement and the recursive call for the second.</p>
<p><strong>Step 2.</strong> Now that we know the form of the recursion, let’s identify the base cases. In this problem, there are two. Why? Well, we’re stripping off two letters at a time and strings can contain either an even or odd number of letters.</p>
<p>Continuing with <code class="docutils literal notranslate"><span class="pre">s</span></code> as the name of the input string, write down when you know a string is a palindrome by checking nothing more than its length.</p>
<p><strong>Step 3.</strong> Let’s start putting our recursive function together. I’ve helped you get started with the function definition and a statement that strips anything other than the letters <code class="docutils literal notranslate"><span class="pre">a-z</span></code> and the digits <code class="docutils literal notranslate"><span class="pre">0-9</span></code>. Yes, your routine will check numbers and phrases with numbers to see if they’re palindromes.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap12/ale02.py</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">is_palindrome</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="sd">&#39;&#39;&#39;Returns True if s is a palindrome&#39;&#39;&#39;</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>    <span class="c1"># Strip prefix/suffix punctuation and spacing</span>
<span class="linenos"> 7</span>    <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39; </span><span class="se">\t\n\&#39;</span><span class="s1">&quot;~!@#$%^&amp;*()-_+=</span><span class="si">{}</span><span class="s1">[]</span><span class="se">\\</span><span class="s1">|;:&lt;&gt;,.?/&#39;</span><span class="p">)</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>    <span class="c1"># REPLACE THIS COMMENT AND THE NEXT RETURN WITH YOUR CODE</span>
<span class="linenos">10</span>    <span class="k">return</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Let’s run a few simple tests.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">42</span><span class="c1">### chap12/ale02.py</span>
<span class="linenos">43</span>
<span class="linenos">44</span><span class="k">def</span> <span class="nf">check</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="linenos">45</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s1">&quot; is&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="linenos">46</span>    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_palindrome</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
<span class="linenos">47</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;not&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="linenos">48</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;a palindrome</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="linenos">49</span>
<span class="linenos">50</span>
<span class="linenos">51</span><span class="n">check</span><span class="p">(</span><span class="s1">&#39;mom&#39;</span><span class="p">)</span>
<span class="linenos">52</span><span class="n">check</span><span class="p">(</span><span class="s1">&#39;Mom&#39;</span><span class="p">)</span>
<span class="linenos">53</span><span class="n">check</span><span class="p">(</span><span class="s1">&#39;121&#39;</span><span class="p">)</span>
<span class="linenos">54</span><span class="n">check</span><span class="p">(</span><span class="s1">&#39;23cs32&#39;</span><span class="p">)</span>
<span class="linenos">55</span><span class="n">check</span><span class="p">(</span><span class="s1">&#39;not&#39;</span><span class="p">)</span>
<span class="linenos">56</span><span class="n">check</span><span class="p">(</span><span class="s1">&#39;notion&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Step 4.</strong> Is it really right to say that <code class="docutils literal notranslate"><span class="pre">'M'</span></code> doesn’t match <code class="docutils literal notranslate"><span class="pre">'m'</span></code>? Have your version of <code class="docutils literal notranslate"><span class="pre">is_palindrome</span></code> ignore capitalization and then rerun the tests above.</p>
<p><strong>Step 5.</strong> Here are a few tougher tests. Try adding some of your own.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">18</span><span class="c1">### chap12/ale02.py</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="c1"># Demetri Martin&#39;s palindrome poem</span>
<span class="linenos">21</span><span class="n">poem</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;Dammit I&#39;m mad.</span>
<span class="linenos">22</span><span class="s1">Evil is a deed as I live.</span>
<span class="linenos">23</span><span class="s1">God, am I reviled? I rise, my bed on a sun, I melt.</span>
<span class="linenos">24</span><span class="s1">To be not one man emanating is sad. I piss.</span>
<span class="linenos">25</span><span class="s1">Alas, it is so late. Who stops to help?</span>
<span class="linenos">26</span><span class="s1">Man, it is hot. I&#39;m in it. I tell.</span>
<span class="linenos">27</span><span class="s1">I am not a devil. I level &quot;Mad Dog&quot;.</span>
<span class="linenos">28</span><span class="s1">Ah, say burning is, as a deified gulp,</span>
<span class="linenos">29</span><span class="s1">In my halo of a mired rum tin.</span>
<span class="linenos">30</span><span class="s1">I erase many men. Oh, to be man, a sin.</span>
<span class="linenos">31</span><span class="s1">Is evil in a clam? In a trap?</span>
<span class="linenos">32</span><span class="s1">No. It is open. On it I was stuck.</span>
<span class="linenos">33</span><span class="s1">Rats peed on hope. Elsewhere dips a web.</span>
<span class="linenos">34</span><span class="s1">Be still if I fill its ebb.</span>
<span class="linenos">35</span><span class="s1">Ew, a spider... eh?</span>
<span class="linenos">36</span><span class="s1">We sleep. Oh no!</span>
<span class="linenos">37</span><span class="s1">Deep, stark cuts saw it in one position.</span>
<span class="linenos">38</span><span class="s1">Part animal, can I live? Sin is a name.</span>
<span class="linenos">39</span><span class="s1">Both, one... my names are in it.</span>
<span class="linenos">40</span><span class="s1">Murder? I&#39;m a fool.</span>
<span class="linenos">41</span><span class="s1">A hymn I plug, deified as a sign in ruby ash.</span>
<span class="linenos">42</span><span class="s1">A Goddam level I lived at.</span>
<span class="linenos">43</span><span class="s1">On mail let it in. I&#39;m it.</span>
<span class="linenos">44</span><span class="s1">Oh, sit in ample hot spots. Oh wet!</span>
<span class="linenos">45</span><span class="s1">A loss it is alas (sip). I&#39;d assign it a name.</span>
<span class="linenos">46</span><span class="s1">Name not one bottle minus an ode by me:</span>
<span class="linenos">47</span><span class="s1">&quot;Sir, I deliver. I&#39;m a dog&quot;</span>
<span class="linenos">48</span><span class="s1">Evil is a deed as I live.</span>
<span class="linenos">49</span><span class="s1">Dammit I&#39;m mad.&#39;&#39;&#39;</span>
<span class="linenos">50</span>
<span class="linenos">51</span><span class="n">check</span><span class="p">(</span><span class="s1">&#39;taco cat&#39;</span><span class="p">)</span>
<span class="linenos">52</span><span class="n">check</span><span class="p">(</span><span class="s1">&#39;Was it a car or a cat I saw?&#39;</span><span class="p">)</span>
<span class="linenos">53</span><span class="n">check</span><span class="p">(</span><span class="s1">&#39;A man, a plan, a canal: Panama!&#39;</span><span class="p">)</span>
<span class="linenos">54</span><span class="n">check</span><span class="p">(</span><span class="s1">&#39;Alli trota la tortilla.&#39;</span><span class="p">)</span>
<span class="linenos">55</span><span class="n">check</span><span class="p">(</span><span class="n">poem</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="ale-12-3-fib-frequently-and-forever">
<h2>ALE 12.3: Fib frequently and forever<a class="headerlink" href="#ale-12-3-fib-frequently-and-forever" title="Permalink to this heading">#</a></h2>
<p>If you enjoy building or graphic design, you’ve probably heard about <a class="reference external" href="https://en.wikipedia.org/wiki/Golden_ratio">the Golden ratio</a>, which is said to make such designs pleasing to the human eye. Definitionally, values <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> satisfy the Golden ratio if <code class="docutils literal notranslate"><span class="pre">a/b</span> <span class="pre">==</span> <span class="pre">(a+b)/a</span></code>, where <code class="docutils literal notranslate"><span class="pre">a</span> <span class="pre">&gt;</span> <span class="pre">b</span> <span class="pre">&gt;</span> <span class="pre">0</span></code>. This ratio is an irrational number, which means that there are no integers <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> that produce it. However, there are sequences produced by simple algorithms that approach its value (1.618033988749…), and one of these sequences is called the <em>Fibonacci numbers</em>.</p>
<p>This is the beginning of the Fibonacci sequence:</p>
<p>0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144, …</p>
<p>You obtain the next number in the sequence by computing the sum of the previous two numbers. For example, <code class="docutils literal notranslate"><span class="pre">144</span></code> follows <code class="docutils literal notranslate"><span class="pre">89</span></code> because it is the <code class="docutils literal notranslate"><span class="pre">55+89</span></code>.</p>
<p>This sequence is related to the Golden ratio because each pair of consecutive Fibonacci numbers (call the smaller of the pair <code class="docutils literal notranslate"><span class="pre">a</span></code> and the larger <code class="docutils literal notranslate"><span class="pre">b</span></code>) approximates this ratio. As the Fibonacci numbers increase in magnitude, these approximations approach the Golden ratio (e.g., 89/55 is a better approximation than 55/34).</p>
<p><strong>Step 1.</strong> If we think of the Fibonacci numbers as a Python sequence, we can design a recursive function <code class="docutils literal notranslate"><span class="pre">fib</span></code> that produces any number in this sequence. Our routine takes a single parameter <code class="docutils literal notranslate"><span class="pre">n</span></code>, which is a zero-based index into the Fibonacci numbers, and then computes the value of the number at that index. For instance, <code class="docutils literal notranslate"><span class="pre">fib(4)</span></code> should return <code class="docutils literal notranslate"><span class="pre">3</span></code>, and the result of <code class="docutils literal notranslate"><span class="pre">fib(12)</span></code> should be <code class="docutils literal notranslate"><span class="pre">144</span></code>.</p>
<ul class="simple">
<li><p>The recursive part of <code class="docutils literal notranslate"><span class="pre">fib</span></code> comes directly from the statement earlier that described how we compute the next number in the Fibonacci sequence: sum the previous two numbers. This means that if we knew <code class="docutils literal notranslate"><span class="pre">fib(n-1)</span></code> and <code class="docutils literal notranslate"><span class="pre">fib(n-2)</span></code>, we could quickly compute and return <code class="docutils literal notranslate"><span class="pre">fib(n)</span></code>.</p></li>
<li><p>The base cases of <code class="docutils literal notranslate"><span class="pre">fib</span></code> are the first two numbers in the Fibonacci sequence, since the recursive step looked back at the previous two numbers.</p></li>
</ul>
<p>With this description, write the body of the function fib in the next code block and test it with the statements in the subsequent block.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="c1">### chap12/ale03.py</span>
<span class="linenos">2</span>
<span class="linenos">3</span><span class="k">def</span> <span class="nf">fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="linenos">4</span><span class="w">    </span><span class="sd">&#39;&#39;&#39;Return the Fibonacci number at 0-based index n&#39;&#39;&#39;</span>
<span class="linenos">5</span>    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">6</span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Fibonacci is defined only for positive n&#39;</span><span class="p">)</span>
<span class="linenos">7</span>    
<span class="linenos">8</span>    <span class="c1"># INSERT BASE CASES AND THE RECURSIVE CALL</span>
<span class="linenos">9</span>    <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># and REMOVE THIS</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">10</span><span class="c1">### chap12/ale03.py</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1"># Test code</span>
<span class="linenos">13</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing fib ...&#39;</span><span class="p">)</span>
<span class="linenos">14</span><span class="k">assert</span> <span class="n">fib</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 0&#39;</span>
<span class="linenos">15</span><span class="k">assert</span> <span class="n">fib</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 1&#39;</span>
<span class="linenos">16</span><span class="k">assert</span> <span class="n">fib</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 2&#39;</span>
<span class="linenos">17</span><span class="k">assert</span> <span class="n">fib</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 3&#39;</span>
<span class="linenos">18</span><span class="k">assert</span> <span class="n">fib</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 4&#39;</span>
<span class="linenos">19</span><span class="k">assert</span> <span class="n">fib</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 5&#39;</span>
<span class="linenos">20</span><span class="k">assert</span> <span class="n">fib</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 6&#39;</span>
<span class="linenos">21</span><span class="k">assert</span> <span class="n">fib</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">21</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 8&#39;</span>
<span class="linenos">22</span><span class="k">assert</span> <span class="n">fib</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">==</span> <span class="mi">144</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 12&#39;</span>
<span class="linenos">23</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PASSED our unit tests!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Step 2.</strong> It is easy to write the body of the recursive function <code class="docutils literal notranslate"><span class="pre">fib</span></code> from the recurrence relation that defines the Fibonacci sequence: <code class="docutils literal notranslate"><span class="pre">fib(n)</span> <span class="pre">=</span> <span class="pre">fib(n-1)</span> <span class="pre">+</span> <span class="pre">fib(n-2)</span></code>. The function <code class="docutils literal notranslate"><span class="pre">ifib</span></code> defined in the next code block is an iterative implementation. Run its tests to verify that it works correctly.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="c1">### chap12/ale03.py</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">ifib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="linenos"> 4</span><span class="w">    </span><span class="sd">&#39;&#39;&#39;Return the Fibonacci number at 0-based index n&#39;&#39;&#39;</span>
<span class="linenos"> 5</span>    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 6</span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Fibonacci is defined only for positive n&#39;</span><span class="p">)</span>
<span class="linenos"> 7</span>    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos"> 8</span>        <span class="k">return</span> <span class="mi">0</span>
<span class="linenos"> 9</span>    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="linenos">10</span>        <span class="k">return</span> <span class="mi">1</span>
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="n">ra</span> <span class="o">=</span> <span class="mi">0</span>    <span class="c1"># fib(0) </span>
<span class="linenos">13</span>    <span class="n">rb</span> <span class="o">=</span> <span class="mi">1</span>    <span class="c1"># fib(1)</span>
<span class="linenos">14</span>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<span class="linenos">15</span>        <span class="c1"># Use last two fib numbers to compute fib(i)</span>
<span class="linenos">16</span>        <span class="n">ra</span><span class="p">,</span> <span class="n">rb</span> <span class="o">=</span> <span class="n">rb</span><span class="p">,</span> <span class="n">ra</span> <span class="o">+</span> <span class="n">rb</span>
<span class="linenos">17</span>
<span class="linenos">18</span>    <span class="k">return</span> <span class="n">rb</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">10</span><span class="c1">### chap12/ale03.py</span>
<span class="linenos">11</span>
<span class="linenos">12</span><span class="c1"># Test code</span>
<span class="linenos">13</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing ifib ...&#39;</span><span class="p">)</span>
<span class="linenos">14</span><span class="k">assert</span> <span class="n">ifib</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 0&#39;</span>
<span class="linenos">15</span><span class="k">assert</span> <span class="n">ifib</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 1&#39;</span>
<span class="linenos">16</span><span class="k">assert</span> <span class="n">ifib</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 2&#39;</span>
<span class="linenos">17</span><span class="k">assert</span> <span class="n">ifib</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 3&#39;</span>
<span class="linenos">18</span><span class="k">assert</span> <span class="n">ifib</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 4&#39;</span>
<span class="linenos">19</span><span class="k">assert</span> <span class="n">ifib</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 5&#39;</span>
<span class="linenos">20</span><span class="k">assert</span> <span class="n">ifib</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 6&#39;</span>
<span class="linenos">21</span><span class="k">assert</span> <span class="n">ifib</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">21</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 8&#39;</span>
<span class="linenos">22</span><span class="k">assert</span> <span class="n">ifib</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span> <span class="o">==</span> <span class="mi">144</span><span class="p">,</span> <span class="s1">&#39;Failed for n = 12&#39;</span>
<span class="linenos">23</span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;PASSED our unit tests!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Step 3.</strong> While the recursive implementation is easy to read and understand compared to the iterative implementation, this easy-of-coding quality comes at a price. In the case of <code class="docutils literal notranslate"><span class="pre">fib</span></code>, it is a big price. Run the next code block and notice, for a large <code class="docutils literal notranslate"><span class="pre">n</span></code>, how quickly <code class="docutils literal notranslate"><span class="pre">ifib</span></code> completes its work compared to <code class="docutils literal notranslate"><span class="pre">fib</span></code>. Feel free to experiment with different values of <code class="docutils literal notranslate"><span class="pre">n</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">10</span><span class="c1">### chap12/ale03.py</span>
<span class="linenos">11</span>
<span class="linenos">12</span>    <span class="c1"># Run with a bigger n</span>
<span class="linenos">13</span>    <span class="n">n</span> <span class="o">=</span> <span class="mi">38</span>
<span class="linenos">14</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Running ifib(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">) = &#39;</span><span class="p">)</span>
<span class="linenos">15</span>    <span class="nb">print</span><span class="p">(</span><span class="n">ifib</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="linenos">16</span>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Running fib(</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">) = &#39;</span><span class="p">)</span>
<span class="linenos">17</span>    <span class="nb">print</span><span class="p">(</span><span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>    
</pre></div>
</div>
<p>What’s the issue that causes this large increase in the running time of such a simple, short function? While it does take longer to execute a function call (i.e., evaluate <code class="docutils literal notranslate"><span class="pre">fib(n-2)</span></code> in <code class="docutils literal notranslate"><span class="pre">fib</span></code>) than to look up a value (i.e., <code class="docutils literal notranslate"><span class="pre">ra</span></code> in <code class="docutils literal notranslate"><span class="pre">ifib</span></code>), this isn’t the real problem. The real culprit is duplicated work.</p>
<p>In computing <code class="docutils literal notranslate"><span class="pre">ifib(38)</span></code>, the interpreter computes, say, the Fibonacci number at index 5 just once, when <code class="docutils literal notranslate"><span class="pre">i</span></code> in the for-loop is set to <code class="docutils literal notranslate"><span class="pre">5</span></code>. How many times does the interpreter compute this same number when we call <code class="docutils literal notranslate"><span class="pre">fib(38)</span></code>? Not once, but many times.</p>
<p>How many times? It’s a cool answer. With <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">38</span></code>, we recursively call <code class="docutils literal notranslate"><span class="pre">fib(36)</span></code> and <code class="docutils literal notranslate"><span class="pre">fib(37)</span></code>. Each of those calls also make recursive calls: <code class="docutils literal notranslate"><span class="pre">fib(36)</span></code> invokes <code class="docutils literal notranslate"><span class="pre">fib(34)</span></code> and <code class="docutils literal notranslate"><span class="pre">fib(35)</span></code>; <code class="docutils literal notranslate"><span class="pre">fib(37)</span></code> invokes <code class="docutils literal notranslate"><span class="pre">fib(35)</span></code> and <code class="docutils literal notranslate"><span class="pre">fib(36)</span></code>. Draw these calls as a tree rooted at <code class="docutils literal notranslate"><span class="pre">fib(38)</span></code>, and you’ll notice (when you draw more of the tree) that there’s one <code class="docutils literal notranslate"><span class="pre">fib(38)</span></code> call, one <code class="docutils literal notranslate"><span class="pre">fib(37)</span></code> call, two <code class="docutils literal notranslate"><span class="pre">fib(36)</span></code> calls, three <code class="docutils literal notranslate"><span class="pre">fib(35)</span></code> calls, five <code class="docutils literal notranslate"><span class="pre">fib(34)</span></code> calls, eight <code class="docutils literal notranslate"><span class="pre">fib(33)</span></code> calls, and so forth. 1, 1, 2, 3, 5, 8 calls. The Fibonacci sequence again!</p>
<p>So how many times is <code class="docutils literal notranslate"><span class="pre">fib(5)</span></code> called in computing <code class="docutils literal notranslate"><span class="pre">fib(38)</span></code>? If <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">38</span></code> is index 1 and <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">37</span></code> is index 2 in the Fibonacci sequence, what is <code class="docutils literal notranslate"><span class="pre">n</span> <span class="pre">=</span> <span class="pre">5</span></code>? Right, <code class="docutils literal notranslate"><span class="pre">38</span> <span class="pre">-</span> <span class="pre">5</span> <span class="pre">+</span> <span class="pre">1</span></code>, or index 34. The Fibonacci number at that index is 5,720,887. That’s a lot of times to calculate <code class="docutils literal notranslate"><span class="pre">fib(5)</span> <span class="pre">=</span> <span class="pre">5</span></code>. We compute similar duplicative work for every number between <code class="docutils literal notranslate"><span class="pre">0</span></code> and <code class="docutils literal notranslate"><span class="pre">n-2</span></code>.</p>
<p>Our computers are fast, but it is possible to overwhelm them with some very simple scripts.</p>
<p>[Version 20241204]</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="chap11.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Chapter 11</p>
      </div>
    </a>
    <a class="right-next"
       href="chap13.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chapter 13</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ale-12-1-a-shell-game">ALE 12.1: A shell game</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ale-12-2-taco-cat">ALE 12.2: Taco cat</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ale-12-3-fib-frequently-and-forever">ALE 12.3: Fib frequently and forever</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Mike Smith
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023 by Michael D. Smith. All rights reserved.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>